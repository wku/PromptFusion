# PromptFusion: Интеллектуальный анализ кодовых баз

## О проекте

PromptFusion - инструмент для взаимодействия с кодовыми базами с использованием языковых моделей (LLM). Проект позволяет анализировать, навигировать и получать консультации по кодовым базам с помощью генеративных языковых моделей.

### Основные возможности

- Анализ структуры проекта и создание описаний файлов
- Семантический поиск по кодовой базе
- Интерактивный чат с ИИ для обсуждения кода
- Поддержка множества языков программирования
- Оптимизация расходов на API

## Установка

1. Клонировать репозиторий
```bash
git clone https://github.com/wku/PromptFusion
cd PromptFusion
```

2. Установить зависимости
```bash
pip install -r requirements.txt
```

3. Создать файл `.env` в корне проекта
```
OPENROUTER_API_KEY=your_api_key_here
```

## Использование

### Запуск

```bash
python app.py
```

При первом запуске вам будет предложено указать путь к проекту для анализа. Программа создаст индекс файлов проекта и их описания с помощью LLM.

### Основные команды в чате

- Задавайте вопросы о структуре и функциональности проекта
- `/clear` - очистить историю сообщений
- `/exit` - выйти из чата

### Примеры вопросов

- "Объясни основную структуру проекта"
- "Как реализована функция X в файле Y?"
- "Найди все места, где используется класс Z"
- "Расскажи о взаимодействии между модулями A и B"

## Архитектура проекта

### Ключевые модули

- **analyzers.py** - Анализаторы структуры кода для различных языков
- **app.py** - Точка входа в приложение
- **config.py** - Управление конфигурацией
- **core.py** - Основная логика приложения
- **improved_chat_session.py** - Реализация чата с промпт-инструментами
- **models.py** - Модели данных
- **prompt_tools.py** - Промпт-инструменты для работы с LLM

### Поддерживаемые языки программирования

- Python
- JavaScript/TypeScript
- Java
- C/C++
- Go
- Rust
- Solidity

## Промпт-инструменты

Проект использует инновационный подход к взаимодействию с LLM через промпт-инжиниринг вместо стандартного API функций. Это обеспечивает совместимость с различными провайдерами LLM.

### Как работают промпт-инструменты

1. В системный промпт добавляются инструкции по использованию функций
2. LLM может вызывать функции в формате `[FUNCTION: имя_функции(параметр="значение")]`
3. Вызовы функций обрабатываются и заменяются результатами в формате `[RESULT: имя_функции]...результат...[/RESULT]`

### Доступные функции

- `get_file(path)` - Загружает содержимое файла
- `find_files_semantic(query, page)` - Ищет файлы с использованием семантического поиска
- `find_in_files(query, is_case_sensitive, page)` - Ищет текст в файлах
- `update_file(path, content)` - Обновляет или создает файл

## Режимы анализа

Проект поддерживает различные режимы описания файлов:

- **MODE_DESC** - Полные описания (стандартный режим)
- **MODE_DESC_NO** - Без описаний
- **MODE_DESC_2** - Краткие описания

## Оптимизация расходов

Система автоматически отслеживает:
- Количество токенов в запросах/ответах
- Стоимость API-запросов
- Размеры файлов

Предупреждает о больших файлах и проектах, которые могут привести к высоким затратам.

## Преимущества проекта

- **Глубокий анализ кода** - специализированные парсеры для разных языков
- **Гибкие настройки** - контроль над включением/исключением файлов
- **Семантический поиск** - использование векторных эмбеддингов
- **Модульная архитектура** - четкое разделение компонентов
- **Локальный анализ** - минимизация данных, отправляемых на LLM
- **Инкрементальные обновления** - обновление только измененных файлов
- **Универсальная совместимость** - работа с различными API LLM

## Ограничения и диагностика

### Известные ограничения
- Зависит от способности LLM корректно следовать формату
- Большие проекты могут требовать значительных ресурсов
- Увеличение размера промптов за счет включения результатов функций

### Советы по диагностике
Если LLM неправильно форматирует вызовы функций:
1. Проверьте системный промпт на наличие четких инструкций
2. Используйте более низкую температуру (0-0.2)
3. Добавьте примеры использования функций

## Вклад в проект

Мы приветствуем вклад в развитие проекта! Если у вас есть предложения по улучшению или вы нашли ошибку:

1. Создайте issue
2. Отправьте pull request с предлагаемыми изменениями

## Лицензия

Проект распространяется под лицензией MIT